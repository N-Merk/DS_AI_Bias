def process_text(text, api_token, prompt_instruction):
    """
        Sendet einen Text zusammen mit einer Prompt-Anweisung an das Hugging Face Modell
        und gibt die vollständige generierte Antwort zurück.

        Parameter:
            text (str): Der zu übersetzende Satz
            prompt_instruction (str): Die Anweisung an das Modell (z. B. "Übersetze nur den Satz...")
            api_token (str): Dein Hugging Face API-Token

        Rückgabe:
            str: Die vollständige Textantwort des Modells (inkl. Prompt und ggf. zusätzlichem Output)
        """

    API_TOKEN = api_token
    #API_URL = "https://router.huggingface.co/featherless-ai/v1/chat/completions"
    API_URL = "https://api-inference.huggingface.co/models/mistralai/Mixtral-8x7B-Instruct-v0.1"
    HEADERS = {"Authorization": f"Bearer {API_TOKEN}"}

    # Funktion zur Anfrage an das Hugging Face Modell
    prompt = f"[INST]{prompt_instruction}\n\n{text}[/INST]"
    payload = {"inputs": prompt, "parameters": {"return_full_text": False}}

    response = requests.post(API_URL, headers=HEADERS, json=payload)

    # Warte, falls Modell noch nicht bereit (503)
    while response.status_code == 503:
        print("Warte auf freien Modell-Server...")
        time.sleep(5)
        response = requests.post(API_URL, headers=HEADERS, json=payload)

    if response.status_code == 200:
        result = response.json()
        # Antwort parsen (erwartet: Liste mit Dict und 'generated_text')
        if isinstance(result, list) and len(result) > 0 and 'generated_text' in result[0]:
            return result[0]['generated_text']
        else:
            print("Unerwartete Antwortstruktur:", result)
            return None
    else:
        print(f"Fehler {response.status_code}: {response.text}")
        return None

def extract_translation(response_text):
    """
    Extrahiert aus der vollständigen Modellantwort nur die tatsächliche Übersetzung,
    indem die letzte nicht-leere Zeile verwendet wird.

    Parameter:
        response_text (str): Die Rückgabe von `translate_text`

    Rückgabe:
        str: Die reine Übersetzung des Satzes
    """
    if not response_text:
        return None

    # Entferne leere Zeilen und führende/abschließende Leerzeichen
    lines = [line.strip() for line in response_text.strip().split("\n") if line.strip()]

    # Die letzte nicht-leere Zeile ist in der Regel die reine Übersetzung
    return lines[-1] if lines else None
